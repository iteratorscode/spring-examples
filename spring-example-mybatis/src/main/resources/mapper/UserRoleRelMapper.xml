<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.iterators.spring.example.mybatis.mapper.UserRoleRelMapper">

    <resultMap id="userVOMap" type="com.iterators.spring.example.mybatis.domain.vo.UserVO">
        <id property="id" column="id"/>
        <result property="name" column="name"/>
        <result property="password" column="password"/>
        <collection property="roles" resultMap="roleVOMap"/>
    </resultMap>

    <resultMap id="roleVOMap" type="com.iterators.spring.example.mybatis.domain.vo.RoleVO">
        <id property="id" column="id"/>
        <result property="name" column="name"/>
        <collection property="authorities" resultMap="authorityVOMap"/>
    </resultMap>

    <resultMap id="authorityVOMap" type="com.iterators.spring.example.mybatis.domain.vo.AuthorityVO">
        <result property="name" column="name"/>
        <result property="code" column="code"/>
        <result property="desc" column="desc"/>
    </resultMap>

    <select id="getByUserId" resultMap="userVOMap">
        SELECT u.id,
               u.name,
               u.password,
               r.id,
               r.name,
               a.name,
               a.code,
               a.desc
        FROM user_role_rel as ur
                 JOIN user as u ON ur.user_id = u.id
                 LEFT JOIN role as r ON ur.role_id = r.id
                 LEFT JOIN authority as a ON r.authority_id = a.id
        WHERE ur.user_id = #{userId};
    </select>
</mapper>
